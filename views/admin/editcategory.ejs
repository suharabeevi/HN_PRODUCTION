<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<head>
    <meta charset="utf-8">
    <title>Trip Arabia | Travel & Tourism</title>

    <meta name="author" content="themesflat.com">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="/app/css/app.css">
    <link rel="stylesheet" href="/app/css/map.min.css">

    <%-include('../layouts/admin/favicon.ejs')%>

</head>

<body class="body header-fixed ">

    <div class="preload preload-container">
        <svg class="pl" width="240" height="240" viewBox="0 0 240 240">
            <circle class="pl__ring pl__ring--a" cx="120" cy="120" r="105" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 660" stroke-dashoffset="-330" stroke-linecap="round"></circle>
            <circle class="pl__ring pl__ring--b" cx="120" cy="120" r="35" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 220" stroke-dashoffset="-110" stroke-linecap="round"></circle>
            <circle class="pl__ring pl__ring--c" cx="85" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
            <circle class="pl__ring pl__ring--d" cx="155" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
        </svg>
    </div>

    <!-- /preload -->

    <div id="wrapper">

        <div id="pagee" class="clearfix">

        <%-include('../layouts/admin/sideheader.ejs')%>
                <!-- End Main Header -->
                <main id="main">
                    <section class="profile-dashboard">
                        
                        <form action="/" id="form-edit-category" class="form-edit-category">
                            <div class="widget-dash-board pr-256 mb-75">
                              <h4 class="title-add-tour mb-30">Edit Category</h4>
                              <div class="grid-input-2 mb-30">
                                <div class="input-wrap">
                                  <label>Category Name *</label>
                                  <input
                                    value="<%= category.name %>"
                                    type="text"
                                    id="category-name"
                                    placeholder="Category name"
                                    data-id="<%= category._id %>"
                                    required
                                  />
                                </div>
                              </div>
                              <div class="grid-input-2 mb-30">
                                <div class="input-wrap">
                                  <label>Description (optional)</label>
                                  <textarea
                                    id="category-description"
                                    placeholder="Category description"
                                    rows="3"
                                  ><%= category.description || '' %></textarea>
                                </div>
                              </div>
                              <div class="input-wrap">
                                <button type="button" class="button-add">Save changes</button>
                              </div>
                            </div>
                          </form>
                          


                    </section>
                </main>

     <%-include('../layouts/admin/footer.ejs')%>

                <!-- Bottom -->
            </div>

        </div>
        <!-- /#page -->
    </div>

    <!-- Modal Popup Bid -->

    <a id="scroll-top" class="button-go"></a>

   

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRightLabel">Offcanvas right</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            ...
        </div>
    </div>

    <!-- Javascript -->
    <script src="/app/js/jquery.min.js"></script>
    <script src="/app/js/jquery.nice-select.min.js"></script>
    <script src="/app/js/bootstrap.min.js"></script>
    <script src="/app/js/tinymce/tinymce.min.js"></script>
    <script src="/app/js/tinymce/tinymce-custom.js"></script>
    <script src="/app/js/swiper-bundle.min.js"></script>
    <script src="/app/js/swiper.js"></script>
    <script src="/app/js/plugin.js"></script>
    <script src="/app/js/map.min.js"></script>
    <script src="/app/js/map.js"></script>
    <script src="/app/js/shortcodes.js"></script>
    <script src="/app/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.querySelector('.button-add').addEventListener('click', async () => {
          // Get the form data
          const categoryInput = document.querySelector('#category-name');
          const categoryName = categoryInput.value.trim();
          const categoryDescription = document.querySelector('#category-description').value.trim();
          const categoryId = categoryInput.getAttribute('data-id'); // Get the category ID
      
          if (!categoryName) {
            return Swal.fire({
              icon: 'error',
              title: 'Oops...',
              text: 'Category name is required!',
            });
          }
      
          try {
            // Send the updated data to the backend
            const response = await fetch(`/admin/categories/${categoryId}`, {
              method: 'PUT', // Use PUT for updates
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ name: categoryName, description: categoryDescription }),
            });
      
            const result = await response.json();
      
            if (response.ok) {
              // Success message
              Swal.fire({
                icon: 'success',
                title: 'Success',
                text: result.message,
                timer: 1500, // Optional: Auto-close after 1.5 seconds
                showConfirmButton: false,
              }).then(() => {
                window.location.href = '/admin/allcategory'; // Redirect to categories list
              });
            } else {
              // Error message
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: result.message,
              });
            }
          } catch (error) {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'An unexpected error occurred. Please try again later.',
            });
          }
        });
      </script>
      

</body>

</html>